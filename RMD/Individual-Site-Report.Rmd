---
output:
  word_document: 
    reference_docx: Supporting-Docs/margin_styles.docx
params:
    STREAM_NAME: 
      value: "South Fork Palouse River"
    ALT_NAME:
      value: "Steptoe Creek"
    STREAM_ID:
      value: "STEPTOE0.70"
---
```{r message=FALSE, warning=FALSE, include=FALSE}
#### READ INSTRUCTIONS BELOW ####

## Follow instructions below to generate a report for an individual sampling site manually.
## To create all sites automatically. Remember, use project name for Stream Name, not the actual stream name
## (e.g. South Fork Palouse River for Steptoe Creeks)


# 1) MANUALLY ENTER DESIRED STREAM NAME, ALT_NAME & SITE/STREAM_ID below (e.g. Kamiache Creek, KC02.8)
## NOTE: SET TO params$STREAM_NAME & params$STREAM_ID respectively for automation

STREAM_NAME = params$STREAM_NAME
ALT_NAME = params$ALT_NAME
STREAM_ID = params$STREAM_ID

# 2) NOW CLICK KNIT (ABOVE) & A REPORT WILL BE GENERATED AUTOMATICALLY
```

```{r message=FALSE, warning=FALSE, include=FALSE}

library(lubridate)

CT_MASTER = read.csv("P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/Cow_and_Thorn_Creeks/Cow Creek/Stream_Flow_and_Water_Quality/Master_Data/Water_Quality_Data/PCD_ML_Merge.csv")

KT_MASTER = read.csv("P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/Kamiache_and_Thorn_Creeks/Kamiache_Creek/Stream_Flow_and_Water_Quality/Master_Data/Water_Quality_Data/PCD_ML_Merge.csv")

PR_MASTER = read.csv("P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/Palouse_River_Tribs/Stream_Flow_and_Water_Quality/Master_Data/Water_Quality_Data/PCD_ML_Merge.csv")

site_grabber = function(site_ID, MASTER){

  SITE = MASTER[MASTER$Station == site_ID,]
    if(STREAM_NAME == "South Fork Palouse River"){
      SITE$DT_round = ymd_hms(SITE$DT_round)
    }
    else{
      SITE$DT_round = mdy_hms(SITE$DT_round)
    }
  SITE = SITE[order(SITE$DT_round),]
  return(SITE)
}



if(STREAM_NAME == "Cow Creek"){
  COW0.07 = as.data.frame(site_grabber(STREAM_ID, CT_MASTER))
  EXT_WEBSITE = "https://wacds.maps.arcgis.com/apps/MapSeries/index.html?appid=404b3d1ffb974b2abf2cf6d38d87cff0"
}
if(STREAM_NAME == "Thorn Creek (Uniontown)"){
  COW0.07 = as.data.frame(site_grabber(STREAM_ID, CT_MASTER))
  EXT_WEBSITE = "https://wacds.maps.arcgis.com/apps/MapSeries/index.html?appid=404b3d1ffb974b2abf2cf6d38d87cff0"
  }
if(STREAM_NAME == "Kamiache Creek"){
  COW0.07 = as.data.frame(site_grabber(STREAM_ID, KT_MASTER))
   EXT_WEBSITE = "http://wacds.maps.arcgis.com/apps/MapSeries/index.html?appid=d80e7c6637154804b7800e56d3ce0a61"
  }
if(STREAM_NAME == "Thorn Creek (Saint John)"){
  COW0.07 = as.data.frame(site_grabber(STREAM_ID, KT_MASTER))
  EXT_WEBSITE = "http://wacds.maps.arcgis.com/apps/MapSeries/index.html?appid=d80e7c6637154804b7800e56d3ce0a61"
}

if(STREAM_NAME == "North Fork Palouse River"){
  COW0.07 = as.data.frame(site_grabber(STREAM_ID, PR_MASTER))
  EXT_WEBSITE = "palousecd.org"
}

if(STREAM_NAME == "South Fork Palouse River"){
  COW0.07 = as.data.frame(site_grabber(STREAM_ID, PR_MASTER))
  EXT_WEBSITE = "palousecd.org"
}

#COW0.07_FIXED = COW0.07[!is.na(COW0.07$pH),]
COW0.07_FIXED = COW0.07
COW0.07_FIXED$Flow..cfs. = round(COW0.07_FIXED$Flow..cfs., 3)
if(STREAM_NAME == "Cow Creek" | STREAM_NAME == "Thorn Creek (Uniontown)"){

FIRST_SAMPLE = format(COW0.07_FIXED[1, 2], format = "%m/%d/%Y")

LAST_SAMPLE = format(COW0.07_FIXED[nrow(COW0.07_FIXED), 2], format = "%m/%d/%Y")
}

if(STREAM_NAME == "Kamiache Creek" | STREAM_NAME == "Thorn Creek (Saint John)"){

FIRST_SAMPLE = format(COW0.07_FIXED[1, 3], format = "%m/%d/%Y")

LAST_SAMPLE = format(COW0.07_FIXED[nrow(COW0.07_FIXED), 3], format = "%m/%d/%Y")
}

if(STREAM_NAME == "North Fork Palouse River" | STREAM_NAME == "South Fork Palouse River"){

FIRST_SAMPLE = format(COW0.07_FIXED[1, 3], format = "%m/%d/%Y")

LAST_SAMPLE = format(COW0.07_FIXED[nrow(COW0.07_FIXED), 3], format = "%m/%d/%Y")
COW0.07_FIXED = COW0.07_FIXED[,c(2:22)]
}


```
<center>
![PCD](P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/PCD.png){#id .class width=75 height=90px}
</center>

<center>
# `r ALT_NAME` Water Quality Report - `r LAST_SAMPLE`
</center>

This is a water quality report created by the Palouse Conservation District's Research & Monitoring program. This report contains data from water quality samples collected on `r ALT_NAME` from site `r STREAM_ID`. Measurements have been collected monthly from this site since `r FIRST_SAMPLE`, with the last water sample collected on `r LAST_SAMPLE`. Several figures have been generated below to show the measurements of water quality parameters over the course of the sampling period. For more information, please contact Ryan Boylan at RyanB@PalouseCD.org, or Nick Harris at NickH@PalouseCD.org. You can also visit our website for more information about the Research & Monitoring program, https://www.palousecd.org/research-and-monitoring.


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

if(STREAM_ID == "COW0.07"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/COW007.jpg"
}
if(STREAM_ID == "COW2.66"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/COW266.jpg"
}
if(STREAM_ID == "COW07.4"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/COW074.jpg"
}
if(STREAM_ID == "COW07.5"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/COW075.jpg"
}
if(STREAM_ID == "COW11.96"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/COW1196.jpg"
}
if(STREAM_ID == "COW18.03"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/COW1803.jpg"
}
if(STREAM_ID == "TH0.12"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/TH012.jpg"
}
if(STREAM_ID == "LTH0.07"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/LTH007.jpg"
}
if(STREAM_ID == "TH03.6"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/TH036.jpg"
}
if(STREAM_ID == "TH04.55"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/TH455.jpg"
}
if(STREAM_ID == "TH07.35"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/TH735.jpg"
}
if(STREAM_ID == "KC02.8"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/KC028.jpg"
}
if(STREAM_ID == "TC00.6"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/TC006.jpg"
}

if(STREAM_ID == "NFPR3"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/NFPR3.jpg"
}

if(STREAM_ID == "STEPTOE0.70"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/SC070.jpg"
}
if(STREAM_ID == "STEPTOE5.23"){
  pather = "P:/Research_and_Monitoring/_04_Project_Data/Water_Quality/_2_R_Scripts/WQM_Markdown/Station Maps/SC523.jpg"
}

knitr::include_graphics(pather)

```



***

# Water Quality Data

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}

library(knitr)
library(kableExtra)
library(pander)
library(flextable)

RECENT_DATA = COW0.07_FIXED[nrow(COW0.07_FIXED),]

RECENT_DATA = t(RECENT_DATA)

RECENT_DATA = as.data.frame(RECENT_DATA)

if(STREAM_NAME == "Cow Creek" | STREAM_NAME == "Thorn Creek (Uniontown)"){

RECENT_DATA$Parameter= c("Station", 
                         "Datetime", 
                         "Nitrogen - Ammonia", 
                         "Nitrogen - Nitrate/Nitrite",
                         "Phosphorus (Orthophosphate)", 
                         "Suspended Sediment Concentration",
                         "Phosphorus (Total)", 
                         "QAQC", 
                         "Notes", 
                         "Temp0", 
                         "Water Temperature",
                         "Barometric Pressure", 
                         "Dissolved Oxygen Percent", 
                         "Dissolved Oxygen Concentration",
                         "Specific Conductivity",
                         "pH", 
                         "Turbidity - Water Transparency",
                         "Fecal Coliform",
                         "Discharge",
                         "Flow Notes",
                         "Turbidity - Water Transparency (Hanna Meter)",
                         "Stage", 
                         "DT_ROUND")

SITE_AVG = as.data.frame(NA)

SITE_AVG$Ammonia = mean(COW0.07_FIXED$Ammonia, na.rm = TRUE)
SITE_AVG$Nitrite = mean(COW0.07_FIXED$Nitrate.Nitrite.as.N, na.rm = TRUE)
SITE_AVG$TP = mean(COW0.07_FIXED$Total.Phosphorus, na.rm = TRUE)
SITE_AVG$OP = mean(COW0.07_FIXED$Ortho.Phosphate, na.rm = TRUE)
SITE_AVG$SSC = mean(COW0.07_FIXED$Suspended.Sediment.Concentration, na.rm = TRUE)
SITE_AVG$FC = mean(COW0.07_FIXED$Fecal.Coliform..cfu.100ml., na.rm = TRUE)
SITE_AVG$DO_p = mean(COW0.07_FIXED$Dissolved.Oxygen...., na.rm = TRUE)
SITE_AVG$DO = mean(COW0.07_FIXED$Dissolved.Oxygen..mg.L., na.rm = TRUE)
SITE_AVG$TEMP = mean(COW0.07_FIXED$Temperature..Sensor.Water...C., na.rm = TRUE)
SITE_AVG$BAR = mean(COW0.07_FIXED$Bar.Press..in.hg., na.rm = TRUE)
SITE_AVG$COND = mean(COW0.07_FIXED$Specific.Conductivity..at.25.deg.C., na.rm = TRUE)
SITE_AVG$TURB = mean(COW0.07_FIXED$Transparency..water, na.rm = TRUE)
SITE_AVG$HAN = mean(COW0.07_FIXED$Transparency..W..Hannah.meter..NTU, na.rm = TRUE)
SITE_AVG$Q = mean(COW0.07_FIXED$Flow..cfs., na.rm = TRUE)
SITE_AVG$STAGE = mean(COW0.07_FIXED$Stage, na.rm = TRUE)
SITE_AVG$pH = mean(COW0.07_FIXED$pH, na.rm = TRUE)

RECENT_DATA = RECENT_DATA[c(3:7,11:19, 21, 22),]

RECENT_DATA = as.data.frame(RECENT_DATA)
colnames(RECENT_DATA) = c(paste("Most Recent Measurement", sep = ' '), "Water Quality Parameter")
RECENT_DATA$Unit = "mg/L"
RECENT_DATA$Unit[6] = "Celsius"
RECENT_DATA$Unit[7] = "mm Hg"
RECENT_DATA$Unit[8] = "%"
RECENT_DATA$Unit[9] = "mg/L"
RECENT_DATA$Unit[10] = "uS/cm"
RECENT_DATA$Unit[11] = "Units"
RECENT_DATA$Unit[12] = "NTU"
RECENT_DATA$Unit[13] = "col/100mL"
RECENT_DATA$Unit[14] = "CFS"
RECENT_DATA$Unit[15] = "NTU"
RECENT_DATA$Unit[16] = "ft"

RECENT_DATA$Site[1] = SITE_AVG$Ammonia
RECENT_DATA$Site[2] = SITE_AVG$Nitrite
RECENT_DATA$Site[3] = SITE_AVG$OP
RECENT_DATA$Site[4] = SITE_AVG$SSC
RECENT_DATA$Site[5] = SITE_AVG$TP
RECENT_DATA$Site[6] = SITE_AVG$TEMP
RECENT_DATA$Site[7] = SITE_AVG$BAR
RECENT_DATA$Site[8] = SITE_AVG$DO_p
RECENT_DATA$Site[9] = SITE_AVG$DO
RECENT_DATA$Site[10] = SITE_AVG$COND
RECENT_DATA$Site[11] = SITE_AVG$pH
RECENT_DATA$Site[12] = SITE_AVG$TURB
RECENT_DATA$Site[13] = SITE_AVG$FC
RECENT_DATA$Site[14] = SITE_AVG$Q
RECENT_DATA$Site[15] = SITE_AVG$HAN
RECENT_DATA$Site[16] = SITE_AVG$STAGE

colnames(RECENT_DATA) = c(paste("Most Recent Measurement", sep = ' '), "Water Quality Parameter", "Unit", "Site Average")

RECENT_DATA = RECENT_DATA[,c(2, 1, 4, 3)]
RECENT_DATA[,2] = as.numeric(as.character(RECENT_DATA[,2]))
RECENT_DATA[,2] = round(RECENT_DATA[,2], 2)
RECENT_DATA[,3] = as.numeric(as.character(RECENT_DATA[,3]))
RECENT_DATA[,3] = round(RECENT_DATA[,3], 2)

row.names(RECENT_DATA) = NULL

table_RD = flextable(
  RECENT_DATA
)

table_RD = autofit(table_RD)

table_RD
}

if(STREAM_NAME == "North Fork Palouse River"){

RECENT_DATA$Parameter= c("Station", 
                         "Datetime", 
                         "Ammonia",
                         "Nitrogen - Nitrate/Nitrite",
                         "Phosphorus (Orthophosphate)", 
                         "Suspended Sediment Concentration",
                         "Phosphorus (Total)", 
                         "QAQC", 
                         "Notes", 
                         "Temp0", 
                         "Water Temperature",
                         "Barometric Pressure", 
                         "Dissolved Oxygen Percent", 
                         "Dissolved Oxygen Concentration",
                         "Specific Conductivity",
                         "pH", 
                         "Turbidity - Water Transparency",
                         "Fecal Coliform",
                         "Discharge",
                         "Turbidity - Water Transparency (Hanna Meter)",
                         "Stage")

SITE_AVG = as.data.frame(NA)

SITE_AVG$Ammonia = mean(COW0.07_FIXED$Ammonia, na.rm = TRUE)
SITE_AVG$Nitrite = mean(COW0.07_FIXED$Nitrate.Nitrite.as.N, na.rm = TRUE)
SITE_AVG$TP = mean(COW0.07_FIXED$Total.Phosphorus, na.rm = TRUE)
SITE_AVG$OP = mean(COW0.07_FIXED$Ortho.Phosphate, na.rm = TRUE)
SITE_AVG$SSC = mean(COW0.07_FIXED$Suspended.Sediment.Concentration, na.rm = TRUE)
SITE_AVG$FC = mean(COW0.07_FIXED$Fecal.Coliform..cfu.100ml., na.rm = TRUE)
SITE_AVG$DO_p = mean(COW0.07_FIXED$Dissolved.Oxygen...., na.rm = TRUE)
SITE_AVG$DO = mean(COW0.07_FIXED$Dissolved.Oxygen..mg.L., na.rm = TRUE)
SITE_AVG$TEMP = mean(COW0.07_FIXED$Temperature..Sensor.Water...C., na.rm = TRUE)
SITE_AVG$BAR = mean(COW0.07_FIXED$Bar.Press..in.hg., na.rm = TRUE)
SITE_AVG$COND = mean(COW0.07_FIXED$Specific.Conductivity..at.25.deg.C., na.rm = TRUE)
SITE_AVG$TURB = mean(COW0.07_FIXED$Transparency..water, na.rm = TRUE)
SITE_AVG$HAN = mean(COW0.07_FIXED$Transparency..W..Hannah.meter..NTU, na.rm = TRUE)
SITE_AVG$Q = mean(COW0.07_FIXED$Flow..cfs., na.rm = TRUE)
SITE_AVG$STAGE = mean(COW0.07_FIXED$Stage, na.rm = TRUE)
SITE_AVG$pH = mean(COW0.07_FIXED$pH, na.rm = TRUE)

RECENT_DATA = RECENT_DATA[c(3:7,11:19, 21, 22),]

RECENT_DATA = as.data.frame(RECENT_DATA)
colnames(RECENT_DATA) = c(paste("Most Recent Measurement", sep = ' '), "Water Quality Parameter")
RECENT_DATA$Unit = "mg/L"
RECENT_DATA$Unit[6] = "Celsius"
RECENT_DATA$Unit[7] = "mm Hg"
RECENT_DATA$Unit[8] = "%"
RECENT_DATA$Unit[9] = "mg/L"
RECENT_DATA$Unit[10] = "uS/cm"
RECENT_DATA$Unit[11] = "Units"
RECENT_DATA$Unit[12] = "NTU"
RECENT_DATA$Unit[13] = "col/100mL"
RECENT_DATA$Unit[14] = "CFS"
RECENT_DATA$Unit[15] = "NTU"
RECENT_DATA$Unit[16] = "ft"

RECENT_DATA$Site[1] = SITE_AVG$Ammonia
RECENT_DATA$Site[2] = SITE_AVG$Nitrite
RECENT_DATA$Site[3] = SITE_AVG$OP
RECENT_DATA$Site[4] = SITE_AVG$SSC
RECENT_DATA$Site[5] = SITE_AVG$TP
RECENT_DATA$Site[6] = SITE_AVG$TEMP
RECENT_DATA$Site[7] = SITE_AVG$BAR
RECENT_DATA$Site[8] = SITE_AVG$DO_p
RECENT_DATA$Site[9] = SITE_AVG$DO
RECENT_DATA$Site[10] = SITE_AVG$COND
RECENT_DATA$Site[11] = SITE_AVG$pH
RECENT_DATA$Site[12] = SITE_AVG$TURB
RECENT_DATA$Site[13] = SITE_AVG$FC
RECENT_DATA$Site[14] = SITE_AVG$Q
RECENT_DATA$Site[15] = SITE_AVG$HAN
RECENT_DATA$Site[16] = SITE_AVG$STAGE

colnames(RECENT_DATA) = c(paste("Most Recent Measurement", sep = ' '), "Water Quality Parameter", "Unit", "Site Average")

RECENT_DATA = RECENT_DATA[,c(2, 1, 4, 3)]
RECENT_DATA[,2] = as.numeric(as.character(RECENT_DATA[,2]))
RECENT_DATA[,2] = round(RECENT_DATA[,2], 2)
RECENT_DATA[,3] = as.numeric(as.character(RECENT_DATA[,3]))
RECENT_DATA[,3] = round(RECENT_DATA[,3], 2)

row.names(RECENT_DATA) = NULL

table_RD = flextable(
  RECENT_DATA
)

table_RD = autofit(table_RD)

table_RD
}


if(STREAM_NAME == "South Fork Palouse River"){

RECENT_DATA$Parameter= c("Station", 
                         "Datetime", 
                         "Suspended Sediment Concentration",
                         "Ammonia",
                         "Nitrogen - Nitrate/Nitrite",
                         "Phosphorus (Orthophosphate)", 
                         "Phosphorus (Total)", 
                         "QAQC", 
                         "Notes", 
                         "Temp0", 
                         "Water Temperature",
                         "Barometric Pressure", 
                         "Dissolved Oxygen Percent", 
                         "Dissolved Oxygen Concentration",
                         "Specific Conductivity",
                         "pH", 
                         "Turbidity - Water Transparency",
                         "Fecal Coliform",
                         "Discharge",
                         "Turbidity - Water Transparency (Hanna Meter)",
                         "Stage")

SITE_AVG = as.data.frame(NA)

SITE_AVG$Ammonia = mean(COW0.07_FIXED$Ammonia, na.rm = TRUE)
SITE_AVG$Nitrite = mean(COW0.07_FIXED$Nitrate.Nitrite.as.N, na.rm = TRUE)
SITE_AVG$TP = mean(COW0.07_FIXED$Total.Phosphorus, na.rm = TRUE)
SITE_AVG$OP = mean(COW0.07_FIXED$Ortho.Phosphate, na.rm = TRUE)
SITE_AVG$SSC = mean(COW0.07_FIXED$Suspended.Sediment.Concentration, na.rm = TRUE)
SITE_AVG$FC = mean(COW0.07_FIXED$Fecal.Coliform..cfu.100ml., na.rm = TRUE)
SITE_AVG$DO_p = mean(COW0.07_FIXED$Dissolved.Oxygen...., na.rm = TRUE)
SITE_AVG$DO = mean(COW0.07_FIXED$Dissolved.Oxygen..mg.L., na.rm = TRUE)
SITE_AVG$TEMP = mean(COW0.07_FIXED$Temperature..Sensor.Water...C., na.rm = TRUE)
SITE_AVG$BAR = mean(COW0.07_FIXED$Bar.Press..in.hg., na.rm = TRUE)
SITE_AVG$COND = mean(COW0.07_FIXED$Specific.Conductivity..at.25.deg.C., na.rm = TRUE)
SITE_AVG$TURB = mean(COW0.07_FIXED$Transparency..water, na.rm = TRUE)
SITE_AVG$HAN = mean(COW0.07_FIXED$Transparency..W..Hannah.meter..NTU, na.rm = TRUE)
SITE_AVG$Q = mean(COW0.07_FIXED$Flow..cfs., na.rm = TRUE)
SITE_AVG$STAGE = mean(COW0.07_FIXED$Stage, na.rm = TRUE)
SITE_AVG$pH = mean(COW0.07_FIXED$pH, na.rm = TRUE)

RECENT_DATA = RECENT_DATA[c(3:7,11:19, 21, 22),]

RECENT_DATA = as.data.frame(RECENT_DATA)
colnames(RECENT_DATA) = c(paste("Most Recent Measurement", sep = ' '), "Water Quality Parameter")
RECENT_DATA$Unit = "mg/L"
RECENT_DATA$Unit[6] = "Celsius"
RECENT_DATA$Unit[7] = "mm Hg"
RECENT_DATA$Unit[8] = "%"
RECENT_DATA$Unit[9] = "mg/L"
RECENT_DATA$Unit[10] = "uS/cm"
RECENT_DATA$Unit[11] = "Units"
RECENT_DATA$Unit[12] = "NTU"
RECENT_DATA$Unit[13] = "col/100mL"
RECENT_DATA$Unit[14] = "CFS"
RECENT_DATA$Unit[15] = "NTU"
RECENT_DATA$Unit[16] = "ft"

RECENT_DATA$Site[1] = SITE_AVG$Ammonia
RECENT_DATA$Site[2] = SITE_AVG$Nitrite
RECENT_DATA$Site[3] = SITE_AVG$OP
RECENT_DATA$Site[4] = SITE_AVG$SSC
RECENT_DATA$Site[5] = SITE_AVG$TP
RECENT_DATA$Site[6] = SITE_AVG$TEMP
RECENT_DATA$Site[7] = SITE_AVG$BAR
RECENT_DATA$Site[8] = SITE_AVG$DO_p
RECENT_DATA$Site[9] = SITE_AVG$DO
RECENT_DATA$Site[10] = SITE_AVG$COND
RECENT_DATA$Site[11] = SITE_AVG$pH
RECENT_DATA$Site[12] = SITE_AVG$TURB
RECENT_DATA$Site[13] = SITE_AVG$FC
RECENT_DATA$Site[14] = SITE_AVG$Q
RECENT_DATA$Site[15] = SITE_AVG$HAN
RECENT_DATA$Site[16] = SITE_AVG$STAGE

colnames(RECENT_DATA) = c(paste("Most Recent Measurement", sep = ' '), "Water Quality Parameter", "Unit", "Site Average")

RECENT_DATA = RECENT_DATA[,c(2, 1, 4, 3)]
RECENT_DATA[,2] = as.numeric(as.character(RECENT_DATA[,2]))
RECENT_DATA[,2] = round(RECENT_DATA[,2], 2)
RECENT_DATA[,3] = as.numeric(as.character(RECENT_DATA[,3]))
RECENT_DATA[,3] = round(RECENT_DATA[,3], 2)

row.names(RECENT_DATA) = NULL

table_RD = flextable(
  RECENT_DATA
)

table_RD = autofit(table_RD)

table_RD
}


if(STREAM_NAME == "Kamiache Creek" | STREAM_NAME == "Thorn Creek (Saint John)" ){
  RECENT_DATA$Parameter= c("X",
                           "Station", 
                           "Datetime", 
                           "DT2",
                           "Nitrogen - Ammonia",
                           "Dissolved Organic Carbon",
                           "FC_NA",
                           "Nitrogen - Nitrate/Nitrite",
                           "Phosphorus (Orthophosphate)", 
                           "Suspended Sediment Concentration",
                           "Total Organic Carbon",
                           "TPN",
                           "Phosphorus (Total)",
                           "TSS",
                           "TURB_NA",
                           "QAQC", 
                           "Air Temp",
                           "Notes", 
                           "Temp0", 
                           "Water Temperature",
                           "Barometric Pressure", 
                           "Dissolved Oxygen Percent", 
                           "Dissolved Oxygen Concentration",
                           "Specific Conductivity", 
                           "pH", 
                           "Turbidity - Water Transparency", 
                           "Fecal Coliform", 
                           "Discharge",
                           "Flow Notes", 
                           "Turbidity - Water Transparency (Hanna meter)",
                           "Stage")

SITE_AVG = as.data.frame(NA)

SITE_AVG$Nitrite = mean(COW0.07_FIXED$Nitrate.Nitrite.as.N, na.rm = TRUE)
SITE_AVG$TP = mean(COW0.07_FIXED$Total.Phosphorus, na.rm = TRUE)
SITE_AVG$OP = mean(COW0.07_FIXED$Ortho.Phosphate, na.rm = TRUE)
SITE_AVG$SSC = mean(COW0.07_FIXED$Suspended.Sediment.Concentration, na.rm = TRUE)
SITE_AVG$FC = mean(COW0.07_FIXED$Fecal.Coliform..cfu.100ml., na.rm = TRUE)
SITE_AVG$DO_p = mean(COW0.07_FIXED$Dissolved.Oxygen...., na.rm = TRUE)
SITE_AVG$DO = mean(COW0.07_FIXED$Dissolved.Oxygen..mg.L., na.rm = TRUE)
SITE_AVG$TEMP = mean(COW0.07_FIXED$Temperature..Sensor.Water...C., na.rm = TRUE)
SITE_AVG$BAR = mean(COW0.07_FIXED$Bar.Press..in.hg., na.rm = TRUE)
SITE_AVG$COND = mean(COW0.07_FIXED$Specific.Conductivity..at.25.deg.C., na.rm = TRUE)
SITE_AVG$TURB = mean(COW0.07_FIXED$Transparency..water, na.rm = TRUE)
SITE_AVG$HAN = mean(COW0.07_FIXED$Transparency..W..Hannah.meter..NTU, na.rm = TRUE)
SITE_AVG$Q = mean(COW0.07_FIXED$Flow..cfs., na.rm = TRUE)
SITE_AVG$STAGE = mean(as.numeric(as.character(COW0.07_FIXED$Stage)), na.rm = TRUE)
SITE_AVG$pH = mean(COW0.07_FIXED$pH, na.rm = TRUE)

RECENT_DATA = RECENT_DATA[c(8:10,13,20:26, 28, 30,31),]

RECENT_DATA = as.data.frame(RECENT_DATA)
colnames(RECENT_DATA) = c(paste("Most Recent Measurement", sep = ' '), "Water Quality Parameter")
RECENT_DATA$Unit = "mg/L"
RECENT_DATA$Unit[5] = "Celsius"
RECENT_DATA$Unit[6] = "mm Hg"
RECENT_DATA$Unit[7] = "%"
RECENT_DATA$Unit[8] = "mg/L"
RECENT_DATA$Unit[9] = "uS/cm"
RECENT_DATA$Unit[10] = "Units"
RECENT_DATA$Unit[11] = "NTU"
RECENT_DATA$Unit[12] = "CFS"
RECENT_DATA$Unit[13] = "NTU"
RECENT_DATA$Unit[14] = "ft"

RECENT_DATA$Site[1] = SITE_AVG$Nitrite
RECENT_DATA$Site[2] = SITE_AVG$OP
RECENT_DATA$Site[3] = SITE_AVG$SSC
RECENT_DATA$Site[4] = SITE_AVG$TP
RECENT_DATA$Site[5] = SITE_AVG$TEMP
RECENT_DATA$Site[6] = SITE_AVG$BAR
RECENT_DATA$Site[7] = SITE_AVG$DO_p
RECENT_DATA$Site[8] = SITE_AVG$DO
RECENT_DATA$Site[9] = SITE_AVG$COND
RECENT_DATA$Site[10] = SITE_AVG$pH
RECENT_DATA$Site[11] = SITE_AVG$TURB
RECENT_DATA$Site[12] = SITE_AVG$Q
RECENT_DATA$Site[13] = SITE_AVG$HAN
RECENT_DATA$Site[14] = SITE_AVG$STAGE

colnames(RECENT_DATA) = c(paste("Most Recent Measurement", sep = ' '), "Water Quality Parameter", "Unit", "Site Average")

RECENT_DATA = RECENT_DATA[,c(2, 1, 4, 3)]
RECENT_DATA[,2] = as.numeric(as.character(RECENT_DATA[,2]))
RECENT_DATA[,2] = round(RECENT_DATA[,2], 2)
RECENT_DATA[,3] = as.numeric(as.character(RECENT_DATA[,3]))
RECENT_DATA[,3] = round(RECENT_DATA[,3], 2)

row.names(RECENT_DATA) = NULL

COW0.07_FIXED = COW0.07_FIXED[,c(2,3,5,8:10,13,16,18:31,4)]

table_RD = flextable(
  RECENT_DATA
)

table_RD = fit_to_width(table_RD)

return(table_RD)

  
  
}



```
\newpage

### Temperature Time-Series

The figure below shows the water temperature in Celsius over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Temperature is measured using a handheld multiparameter sonde. The graph includes the maximum threshold of 17.5 degrees Celsius for temperature according to the Water Quality Standards for Surface Waters of the State of Washington [WAC 173-201A-200].
<center>
```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)
library(ggthemes)

TEMP = COW0.07_FIXED[,c(2, 11)]
colnames(TEMP) = c("Datetime", "Temperature")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = Temperature))+
  geom_line(aes(x = Datetime, y = Temperature))+
  geom_hline(yintercept = 17.5, color = "red", size = 1, linetype ="dashed", show.legend = TRUE)+
  ylab("Water Temperature (C)")+
  theme_economist()+
  theme(legend.position = "right")

return(TEMP_PLOT)

```
</center>
*Note: Figures may include gaps in data due to missed measurements

\newpage

### Dissolved Oxygen Time-Series

The figure below shows the dissolved oxygen in the water, measured in milligrams per liter (mg/L), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Gaseous oxygen is able to dissolve into stream water and is beneficial to aquatic life. Higher dissolved oxygen allows for healthier environments for fish and other organisms found in these streams. Dissolved oxygen levels change seasonally and even throughout the day. Dissolved oxygen is measured using a handheld multiparameter sonde. The graph includes the minimum threshold of 9.5 mg/L for dissolved oxygen according to the Water Quality Standards for Surface Waters of the State of Washington [WAC 173-201A-200].

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

TEMP = COW0.07_FIXED[,c(2, 14)]
colnames(TEMP) = c("Datetime", "DO")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = DO))+
  geom_line(aes(x = Datetime, y = DO))+
  ylab("Dissolved Oxygen (mg/L)")+
  geom_hline(yintercept = 9.5, color = "red", size = 1, linetype ="dashed", show.legend = TRUE)+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed measurements

\newpage

### Conductivity Time-Series
The figure below shows the specific conductivity in the water, measured in microsiemens per centimeter (uS/cm), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Electrical conductance in water occurs when there are a higher amount of molecules in the water that are either positively or negatively charged. These molecules are typically salts in natural waterways. Higher conductivity allows for an easier pathway for electrical sources to pass through and is an indicator on ion levels in water. Conductivity is measured using a handheld multiparameter sonde.

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

TEMP = COW0.07_FIXED[,c(2, 15)]
colnames(TEMP) = c("Datetime", "COND")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = COND))+
  geom_line(aes(x = Datetime, y = COND))+
  ylab("Conductivity (uS/cm)")+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed measurements

\newpage

### pH Time-Series
The figure below shows the pH levels in the water over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Measuring pH in stream water indicates water acidity or alkalinity. These measurements range from 0-14 units and are an important indicator for determining biological health of an aquatic environment. Differing pH levels allow for different amounts of chemical constituents, such as heavy metals and nutrients, to be dissolved in water. pH is measured using a handheld multiparameter sonde. The graph includes the minimum and maximum thresholds, 6.5 and 8.5 pH units respectively, for pH according to the Water Quality Standards for Surface Waters of the State of Washington [WAC 173-201A-200].

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

TEMP = COW0.07_FIXED[,c(2, 16)]
colnames(TEMP) = c("Datetime", "pH")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = pH))+
  geom_line(aes(x = Datetime, y = pH))+
  geom_hline(yintercept = 6.5, color = "red", size = 1, linetype ="dashed", show.legend = TRUE)+
  geom_hline(yintercept = 8.5, color = "red", size = 1, linetype ="dashed", show.legend = TRUE)+
  ylab("pH")+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed measurements

\newpage

### Turbidity Time-Series
The figure below shows the turbidity in the water, measured in nephelometric turbidity units (NTU), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Turbidity measures the clarity of stream water by determining how much light can pass through it. Higher turbidity causes increased light scattering, causing less light to pass through the water. Light directly affects ecological productivity and habitat quality in aquatic environments. Excess turbidity can be caused by physical disruption of the stream bank or bed, and through sediment inputs from runoff in upland upland areas.  Turbidity is measured using a handheld multiparameter sonde.

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

TEMP = COW0.07_FIXED[,c(2, 17)]
colnames(TEMP) = c("Datetime", "TURB")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = TURB))+
  geom_line(aes(x = Datetime, y = TURB))+
  ylab("Turbidity (NTU)")+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed measurements

\newpage

### Discharge Time-Series
The figure below shows the discharge of the stream, measured in cubic feet per second (CFS), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Stream discharge is calculated by measuring velocity across the cross-sectional area of a stream channel. Measuring devices include a velocimeter and stadia rod or measuring tape. Discharge allows us to calculate nutrient and sediment loading for a stream.

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

TEMP = COW0.07_FIXED[,c(2, 19)]
colnames(TEMP) = c("Datetime", "Q")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = Q))+
  geom_line(aes(x = Datetime, y = Q))+
  ylab("Discharge (CFS)")+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed measurements

\newpage

### Fecal Coliform Time-Series
The figure below shows the fecal coliform measurements in the water, colonies per 100 milliliters (cols/100mL), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Fecal coliform bacteria is a group of coliform bacteria that is used as an indicator of fecal contamination from animals. Fecal coliform samples are collected in-stream and analyzed at the Colfax Wastewater Treatment Plant. The graph includes the maximum threshold for fecal coliform levels according to the Water Quality Standards for Surface Waters of the State of Washington [WAC 173-201A-200].

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)
if(STREAM_NAME == "Cow Creek" | STREAM_NAME == "Thorn Creek (Uniontown)"| STREAM_NAME == "North Fork Palouse River"){
TEMP = COW0.07_FIXED[,c(2, 18)]
colnames(TEMP) = c("Datetime", "FC")

TEMP_PLOT = ggplot(TEMP, aes(x = Datetime, y = FC))+
  geom_point()+
  geom_line()+
  ylab("Fecal Coliform (cols/100mL)")+
  geom_hline(yintercept = 200, color = "red", size = 1, linetype ="dashed", show.legend = TRUE)+
  theme_economist()


return(TEMP_PLOT)
}

if(STREAM_NAME == "Kamiache Creek" | STREAM_NAME == "Thorn Creek (Saint John)")
  
cat("Data unavailable for this site")

```

*Note: Figures may include gaps in data due to missed samples

\newpage

### Ammonia Time-Series
The figure below shows the ammonia measurements, measured in milligrams per liter (mg/L), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Nitrogen is found naturally in the environment and is fairly abundant. However, nitrogen levels can also be influenced by humans as well, sewage systems and fertilizer application are good examples of nitrogen sources. Nitrogen helps aquatic plants grow, but in excess this can cause overgrowth, which reduces dissolved oxygen in water, leading to eutrophication of a body of water if left unchecked. Nitrate, nitrite, and ammonia are three common forms of nitrogen we find in streams. Ammonia samples are collected in-stream and analyzed at Manchester Environmental Laboratory.

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)
if(STREAM_NAME == "Cow Creek" | STREAM_NAME == "Thorn Creek (Uniontown)" | STREAM_NAME == "North Fork Palouse River"){

TEMP = COW0.07_FIXED[,c(2, 3)]
colnames(TEMP) = c("Datetime", "Ammonia")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = Ammonia))+
  geom_line(aes(x = Datetime, y = Ammonia))+
  ylab("Ammonia (mg/L)")+
  theme_economist()

return(TEMP_PLOT)
}

if(STREAM_NAME == "Kamiache Creek" | STREAM_NAME == "Thorn Creek (Saint John)")
  
cat("Data unavailable for this site")


```

*Note: Figures may include gaps in data due to missed samples

\newpage

### Nitrate/Nitrite Time-Series
The figure below shows the nitrate & nitrite measurements, both measured in milligrams per liter (mg/L), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Nitrogen is found naturally in the environment and is fairly abundant. However, nitrogen levels can also be influenced by humans as well, sewage systems and fertilizer application are good examples of nitrogen sources. Nitrogen helps aquatic plants grow, but in excess this can cause overgrowth, which reduces dissolved oxygen in water, leading to eutrophication of a body of water if left unchecked. Nitrate, nitrite, and ammonia are three common forms of nitrogen we find in streams. Nitrate & nitrite samples are collected in-stream and analyzed at Manchester Environmental Laboratory.

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

if(STREAM_NAME == "South Fork Palouse River"){
 TEMP = COW0.07_FIXED[,c(2, 5)]
} else{TEMP = COW0.07_FIXED[,c(2, 4)]}

colnames(TEMP) = c("Datetime", "N")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = N))+
  geom_line(aes(x = Datetime, y = N))+
  ylab("Nitrate/Nitrite (mg/L)")+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed samples

\newpage

### Total Phosphorus Time-Series
The figure below shows the total phosphorus measurements, measured in milligrams per liter (mg/L), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Much like nitrogen, phosphorus is a vital nutrient for aquatic plant life. Phosphorus is also used as a chemical fertilizer in agriculture and can lead to eutrophication in bodies of water. Total phosphorus and orthophosphate are the two forms of phosphorus we measure in streams. Total phosphorus includes all forms of phosphorus found in the stream, similar to total organic carbon in the case or carbon in the stream. Total phosphorus samples are collected in-stream and analyzed at Manchester Environmental Laboratory. The graph includes the maximum allowance threshold recommended for total phosphorus levels by the U.S. Environmental Protection Agency.

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

TEMP = COW0.07_FIXED[,c(2, 7)]
colnames(TEMP) = c("Datetime", "TP")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = TP))+
  geom_line(aes(x = Datetime, y = TP))+
  ylab("Total Phosphorus (mg/L)")+
  geom_hline(yintercept = 0.1, color = "red", size = 1, linetype ="dashed", show.legend = TRUE)+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed samples

\newpage

### Orthophosphate Time-Series
The figure below shows the orthophosphate measurements, measured in milligrams per liter (mg/L), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Much like nitrogen, phosphorus is a vital nutrient for aquatic plant life. Phosphorus is also used as a chemical fertilizer in agriculture and can lead to eutrophication in bodies of water. Total phosphorus and orthophosphate are the two forms of phosphorus we measure in streams. Orthophosphates (OP) are a reactive form of phosphates that are mainly sourced from fertilizers or other human sources. Orthophosphates can give a good estimation on how much phosphorus is available for plants. Orthophosphate samples are collected in-stream and analyzed at Manchester Environmental Laboratory.

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

TEMP = COW0.07_FIXED[,c(2, 5)]
colnames(TEMP) = c("Datetime", "OP")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = OP))+
  geom_line(aes(x = Datetime, y = OP))+
  ylab("Orthophosphate (mg/L)")+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed samples

\newpage

### Suspended Sediment Concentration Time-Series
The figure below shows the suspended sediment concentration measurements, measured in milligrams per liter (mg/L), over time for this site (`r FIRST_SAMPLE` - `r LAST_SAMPLE`). Sediment typically finds its way to a stream after a rainfall event through the process of runoff. Suspended sediment are the particles of soil that is moved by water through a channel. It is important to know how much sediment a stream conveys, as sediment deposited downstream can alter the way a river flows. Suspended sediment concentration varies constantly in relation to discharge, but frequent sampling gives us an idea of how much sediment moves through the river over time. Suspended sediment concentration samples are collected in-stream and analyzed at Manchester Environmental Laboratory.`

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(plotly)
library(ggplot2)

TEMP = COW0.07_FIXED[,c(2, 6)]
colnames(TEMP) = c("Datetime", "SSC")

TEMP_PLOT = ggplot(TEMP)+
  geom_point(aes(x = Datetime, y = SSC))+
  geom_line(aes(x = Datetime, y = SSC))+
  ylab("Suspended Sediment Concentration (mg/L)")+
  theme_economist()

return(TEMP_PLOT)

```

*Note: Figures may include gaps in data due to missed samples
